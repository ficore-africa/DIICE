{% extends "base.html" %}
{% block title %}{{ title }} - FiCore{% endblock %}
{% block content %}
<div class="container mt-5">
    <!-- Language Toggler -->
    <form method="post" action="{{ url_for('admin.toggle_user_language', user_id=current_user.id, language='en') }}" class="mb-3 d-inline">
        <input type="hidden" name="language" value="en">
        <button type="submit" class="btn btn-outline-primary btn-sm {% if current_user.language == 'en' %}active{% endif %}">English</button>
    </form>
    <form method="post" action="{{ url_for('admin.toggle_user_language', user_id=current_user.id, language='ha') }}" class="mb-3 d-inline">
        <input type="hidden" name="language" value="ha">
        <button type="submit" class="btn btn-outline-primary btn-sm {% if current_user.language == 'ha' %}active{% endif %}">Hausa</button>
    </form>
    <span class="ms-2 text-muted">{{ t('admin_language_toggle', default='Switch Language') }}</span>
    <h1>{{ title }}</h1>
    <div class="row">
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_users', default='Users') }}</h5>
                    <p class="card-text">{{ stats.users }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_records', default='Income Records') }}</h5>
                    <p class="card-text">{{ stats.records }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_cashflows', default='Payment Outflows') }}</h5>
                    <p class="card-text">{{ stats.cashflows }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_debtors', default='Debtors') }}</h5>
                    <p class="card-text">{{ stats.debtors }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_creditors', default='Creditors') }}</h5>
                    <p class="card-text">{{ stats.creditors }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_audit_logs', default='Audit Logs') }}</h5>
                    <p class="card-text">{{ stats.audit_logs }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ t('admin_feedback', default='Feedback') }}</h5>
                    <p class="card-text">{{ stats.feedback }}</p>
                </div>
            </div>
        </div>
    </div>

    <h2>{{ t('admin_quick_actions', default='Quick Actions') }}</h2>
    
    <!-- User Management Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="text-muted">{{ t('admin_user_management', default='User Management') }}</h4>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_users') }}" class="btn btn-primary w-100">{{ t('admin_manage_users', default='Manage Users') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_user_roles') }}" class="btn btn-primary w-100">{{ t('admin_manage_user_roles', default='Manage User Roles') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_user_subscriptions') }}" class="btn btn-primary w-100">{{ t('admin_manage_user_subscriptions', default='Manage User Subscriptions') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_user_trials') }}" class="btn btn-success w-100">{{ t('admin_manage_user_trials', default='Manage User Trials') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.bulk_operations') }}" class="btn btn-warning w-100">{{ t('admin_bulk_operations', default='Bulk Operations') }}</a>
        </div>
    </div>

    <!-- Reports & Analytics Section -->
    <div class="row mb-4">
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.analytics_dashboard') }}" class="btn btn-info w-100">{{ t('admin_analytics_dashboard', default='Analytics Dashboard') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.enhanced_analytics_dashboard') }}" class="btn btn-info w-100">{{ t('admin_enhanced_analytics', default='Enhanced Analytics') }}</a>
        </div>
    </div>

    <!-- System Management Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="text-muted">{{ t('admin_system_management', default='System Management') }}</h4>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.system_settings') }}" class="btn btn-dark w-100">{{ t('admin_system_settings', default='System Settings') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.system_health_monitor') }}" class="btn btn-dark w-100">{{ t('admin_system_health', default='System Health Monitor') }}</a>
        </div>
    </div>

    <!-- Tax & Configuration Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="text-muted">{{ t('admin_tax_config', default='Tax & Configuration') }}</h4>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.tax_config') }}" class="btn btn-warning w-100">{{ t('admin_tax_config', default='Tax Configuration') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_tax_rates') }}" class="btn btn-warning w-100">{{ t('admin_tax_rates', default='Manage Tax Rates') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_tax_bands') }}" class="btn btn-warning w-100">{{ t('admin_tax_bands', default='Manage Tax Bands') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_tax_exemptions') }}" class="btn btn-warning w-100">{{ t('admin_tax_exemptions', default='Manage Tax Exemptions') }}</a>
        </div>
    </div>

    <!-- Other Management Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="text-muted">{{ t('admin_other_management', default='Other Management') }}</h4>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.manage_feedback') }}" class="btn btn-secondary w-100">{{ t('admin_manage_feedback', default='Manage Feedback') }}</a>
        </div>
        <div class="col-md-4 mb-2">
            <a href="{{ url_for('admin.education_management') }}" class="btn btn-info w-100">{{ t('admin_education_management', default='Education Management') }}</a>
        </div>
    </div>

    <h2 class="mt-4">{{ t('admin_recent_users', default='Recent Users') }}</h2>
    <table class="table">
        <thead>
            <tr>
                <th>{{ t('admin_username', default='Username') }}</th>
                <th>{{ t('admin_email', default='Email') }}</th>
                <th>{{ t('user_role', default='Role') }}</th>
                <th>{{ t('subscription_status', default='Subscription Status') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for user in recent_users %}
            <tr>
                <td>{{ user._id }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                    {% if user.is_trial_active %}
                        {{ 'Subscribed' if user.is_subscribed else 'Trial' }}
                    {% else %}
                        {{ t('subscription_expired', default='Expired') }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
