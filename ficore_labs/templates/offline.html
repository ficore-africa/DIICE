<!DOCTYPE html>
<html lang="{{ current_lang | default('en') | e }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline - {{ t('general_ficore_africa', default='FiCore Africa') | e }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            color: white;
        }
        
        .offline-container {
            text-align: center;
            max-width: 500px;
            padding: 3rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .offline-icon {
            font-size: 5rem;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .offline-title {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .offline-message {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .offline-features {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: left;
        }
        
        .offline-features h4 {
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .offline-features ul {
            list-style: none;
            padding: 0;
        }
        
        .offline-features li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
        }
        
        .offline-features li i {
            margin-right: 0.75rem;
            color: #28a745;
            font-size: 1.2rem;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn-custom {
            padding: 0.75rem 2rem;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .btn-custom:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary-custom {
            background: #007bff;
            border-color: #007bff;
        }
        
        .btn-primary-custom:hover {
            background: #0056b3;
            border-color: #0056b3;
        }
        
        .network-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .network-status.online {
            background: rgba(40, 167, 69, 0.9);
        }
        
        @media (max-width: 768px) {
            .offline-container {
                margin: 1rem;
                padding: 2rem 1.5rem;
            }
            
            .offline-title {
                font-size: 2rem;
            }
            
            .offline-icon {
                font-size: 4rem;
            }
            
            .btn-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-custom {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="network-status" id="networkStatus">
        <i class="bi bi-wifi-off"></i> Offline
    </div>
    
    <div class="offline-container">
        <div class="offline-icon">
            <i class="bi bi-wifi-off"></i>
        </div>
        
        <h1 class="offline-title">You're Offline</h1>
        
        <p class="offline-message">
            Don't worry! FiCore Africa works offline too. You can continue managing your business data, and everything will sync when you're back online.
        </p>
        
        <div class="offline-features">
            <h4><i class="bi bi-check-circle-fill me-2"></i>What you can do offline:</h4>
            <ul>
                <li><i class="bi bi-person-plus-fill"></i> Add new debtors and creditors</li>
                <li><i class="bi bi-box-seam"></i> Manage inventory items</li>
                <li><i class="bi bi-receipt"></i> Record transactions</li>
                <li><i class="bi bi-eye-fill"></i> View your existing data</li>
                <li><i class="bi bi-graph-up"></i> Generate basic reports</li>
                <li><i class="bi bi-arrow-repeat"></i> Auto-sync when online</li>
            </ul>
        </div>
        
        <div class="btn-group">
            <button class="btn-custom btn-primary-custom" onclick="retryConnection()">
                <i class="bi bi-arrow-clockwise me-2"></i>Try Again
            </button>
            <a href="/dashboard" class="btn-custom">
                <i class="bi bi-house-fill me-2"></i>Go to Dashboard
            </a>
            <button class="btn-custom" onclick="showOfflineData()">
                <i class="bi bi-database-fill me-2"></i>View Offline Data
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Network status monitoring
        function updateNetworkStatus() {
            const statusElement = document.getElementById('networkStatus');
            if (navigator.onLine) {
                statusElement.innerHTML = '<i class="bi bi-wifi"></i> Online';
                statusElement.classList.add('online');
                // Auto-redirect when back online
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                statusElement.innerHTML = '<i class="bi bi-wifi-off"></i> Offline';
                statusElement.classList.remove('online');
            }
        }

        // Event listeners
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);

        // Initial status check
        updateNetworkStatus();

        // Retry connection
        function retryConnection() {
            const btn = event.target;
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="bi bi-arrow-repeat spin me-2"></i>Checking...';
            btn.disabled = true;
            
            // Check connection
            fetch('/api/health', { 
                method: 'GET',
                cache: 'no-cache'
            })
            .then(response => {
                if (response.ok) {
                    btn.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>Connected!';
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    throw new Error('Still offline');
                }
            })
            .catch(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                // Show temporary message
                const tempMsg = document.createElement('div');
                tempMsg.className = 'alert alert-warning mt-3';
                tempMsg.innerHTML = '<i class="bi bi-exclamation-triangle-fill me-2"></i>Still offline. Please check your connection.';
                btn.parentNode.appendChild(tempMsg);
                
                setTimeout(() => {
                    if (tempMsg.parentNode) {
                        tempMsg.remove();
                    }
                }, 3000);
            });
        }

        // Show offline data
        function showOfflineData() {
            if (window.offlineManager) {
                window.offlineManager.showOfflineData();
            } else {
                alert('Offline data viewer is not available. Please try refreshing the page.');
            }
        }

        // Add spinning animation for retry button
        const style = document.createElement('style');
        style.textContent = `
            .spin {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>